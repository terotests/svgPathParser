(function(){var t={},n=function(){var t=function(){!function(t){var n,i,r,o,s,e,a,y;t.add=function(t,n){t.x=t.x+n.x,t.y=t.y+n.y},t.angleBetween=function(t,n){var i=this.normalize({x:t.x,y:t.y}),r=this.normalize({x:n.x,y:n.y}),o=this.crossProd(i,r),s=this.dotProd(i,r),e=Math.acos(s);return 0>o&&(e=-1*e),e},t.calc_cat=function(t,n,i,r,o){var s=t*t,e=s*t;return.5*(2*i+(-n+r)*t+(2*n-5*i+4*r-o)*s+(-n+3*i-3*r+o)*e)},t.crossProd=function(t,n){return t.x*n.y-t.y*n.x},t.diff=function(t,n){return{x:n.x-t.x,y:n.y-t.y}},t.dist=function(t,n){var i=t.x-n.x,r=t.y-n.y;return Math.sqrt(i*i+r*r)},t.dotProd=function(t,n){return t.x*n.x+t.y*n.y},t.getBarCoeffs=function(t,n,i){var r=a;return r.A=.5*(-n.y*i.x+t.y*(-n.x+i.x)+t.x*(n.y-i.y)+n.x*i.y),r.sign=r.A<0?-1:1,r.s1=(t.y*i.x-t.x*i.y+(i.y-t.y))*r.sign,r.s2=(i.y-t.y)*r.sign,r.s3=(t.x-i.x)*r.sign,r.t1=(t.x*n.y-t.y*n.x)*r.sign,r.t2=(t.y-n.y)*r.sign,r.t3=(n.x-t.x)*r.sign,r},t.__traitInit&&!t.hasOwnProperty("__traitInit")&&(t.__traitInit=t.__traitInit.slice()),t.__traitInit||(t.__traitInit=[]),t.__traitInit.push(function(){s||(s={x:0,y:0},e={x:0,y:0},n=[0,0,0,0],i={x:0,y:0},r={x:0,y:0},o={x:0,y:0},a={Area:0,s1:0,s2:0,s3:0,t1:0,t2:0,t3:0,sign:0},y={x:0,y:0})}),t.initProjection=function(t,n){r.y=n.y-t.y,r.x=n.x-t.x,i.y=r.y,i.x=r.x,this.normalize(r),this.normalize(i),this.rotate(i,Math.PI/2),o.x=t.x,o.y=t.y},t.length=function(t){var n=t.x,i=t.y;return Math.sqrt(n*n+i*i)},t.linesIntersect=function(t,n,i,r){var o=t.x,s=t.y,e=n.x,a=n.y,y=i.x,f=i.y,x=r.x,h=r.y,u=((o*a-s*e)*(y-x)-(o-e)*(y*h-f*x))/((o-e)*(f-h)-(s-a)*(y-x)),c=((o*a-s*e)*(f-h)-(s-a)*(y*h-f*x))/((o-e)*(f-h)-(s-a)*(y-x));if(isNaN(u)||isNaN(c))return!1;if(o>=e){if(!(u>=e&&o>=u))return!1}else if(!(u>=o&&e>=u))return!1;if(s>=a){if(!(c>=a&&s>=c))return!1}else if(!(c>=s&&a>=c))return!1;if(y>=x){if(!(u>=x&&y>=u))return!1}else if(!(u>=y&&x>=u))return!1;if(f>=h){if(!(c>=h&&f>=c))return!1}else if(!(c>=f&&h>=c))return!1;return!0},t.mirrorVector=function(t,n,i){s.x=n.x-i.x,s.y=n.y-i.y,e.x=-s.y,e.y=s.x,t.x=t.x-i.x,t.y=t.y-i.y,this.dotProd(t,e)>0&&this.rotate(e,Math.PI),this.normalize(s),this.normalize(e);var r=Math.abs(this.dotProd(t,e)),o=this.dotProd(t,s);return t.x=e.x*r+s.x*o,t.y=e.y*r+s.y*o,t.x+=i.x,t.y+=i.y,t},t.normalize=function(t){var n=Math.sqrt(t.x*t.x+t.y*t.y);if(0==n)throw"Error normalizing vector: the length of the vector was zero";return t.x=t.x/n,t.y=t.y/n,t},t.opposeVector=function(t,n){s.x=n,x,s.y=n.y,e.x=-s.y,e.y=s.x,this.normalize(s),this.normalize(e),this.rotate(s,Math.PI);var i=Math.abs(jsMath.dotProd(t,e)),r=Math.abs(jsMath.dotProd(t,s));return this.dotProd(t,e)<0&&this.rotate(e,Math.PI),t.x=e.x*i+s.x*r,t.y=e.y*i+s.y*r,t},t.pointInTriangle=function(t,n,i,r){var o=.5*(-i.y*r.x+n.y*(-i.x+r.x)+n.x*(i.y-r.y)+i.x*r.y),s=0>o?-1:1,e=(n.y*r.x-n.x*r.y+(r.y-n.y)*t.x+(n.x-r.x)*t.y)*s,a=(n.x*i.y-n.y*i.x+(n.y-i.y)*t.x+(i.x-n.x)*t.y)*s;return e>0&&a>0&&2*o*s>e+a},t.pointInTriangleBc=function(t,n){var i=n.A,r=n.sign,o=n.s1+n.s2*t.x+n.s3*t.y,s=n.t1+n.t2*t.x+n.t3*t.y;return o>0&&s>0&&2*i*r>o+s},t.project=function(t){var n=t;return pVector.x=n.x-o.x,pVector.y=n.y-o.y,prodResult.i=this.dotProd(pVector,r),prodResult.j=this.dotProd(pVector,i),prodResult},t.rotate=function(t,n){var i=Math.sin(n),r=Math.cos(n),o=t.x,s=t.y;return t.x=o*r+s*i,t.y=-o*i+s*r,t},t.rotateAround=function(t,n,i){this.sub(n,i),this.rotate(n,t),this.add(n,i)},t.sub=function(t,n){t.x=t.x-n.x,t.y=t.y-n.y},t.tangentNormal=function(t,n,i){var r={};r.x=n.x-t.x,r.y=n.y-t.y;var o={};o.x=i.x-n.x,o.y=i.y-n.y;var s={x:r.x+o.x,y:r.y+o.y};return this.normalize(s)},t.triangleArea=function(t,n,i){var r=t.x*(n.y-i.y)+n.x*(i.y-t.y)+i.x*(t.y-n.y);return Math.abs(r/2)},t.triangleInTriangle=function(t,n,i,r,o,s){var e=this.getBarCoeffs(t,n,i);if(this.pointInTriangleBc(r,e))return!0;if(this.pointInTriangleBc(o,e))return!0;if(this.pointInTriangleBc(s,e))return!0;var e=this.getBarCoeffs(r,o,s);return this.pointInTriangleBc(t,e)?!0:this.pointInTriangleBc(n,e)?!0:this.pointInTriangleBc(i,e)?!0:this.linesIntersect(t,n,r,o)?!0:this.linesIntersect(n,i,r,o)?!0:this.linesIntersect(i,t,r,o)?!0:this.linesIntersect(t,n,o,s)?!0:this.linesIntersect(n,i,o,s)?!0:this.linesIntersect(i,t,o,s)?!0:this.linesIntersect(t,n,s,r)?!0:this.linesIntersect(n,i,s,r)?!0:this.linesIntersect(i,t,s,r)?!0:!1},t.unProject=function(t){var n=t;return y.x=n.i*r.x+n.j*i.x,y.y=n.i*r.y+n.j*i.y,y.x+=o.x,y.y+=o.y,y}}(this)},n=function(t,i,r,o,s,e,a,y){var f,x=this;if(!(x instanceof n))return new n(t,i,r,o,s,e,a,y);var h=[t,i,r,o,s,e,a,y];if(x.__factoryClass)if(x.__factoryClass.forEach(function(t){f=t.apply(x,h)}),"function"==typeof f){if(f._classInfo.name!=n._classInfo.name)return new f(t,i,r,o,s,e,a,y)}else if(f)return f;x.__traitInit?x.__traitInit.forEach(function(t){t.apply(x,h)}):"function"==typeof x.init&&x.init.apply(x,h)};n._classInfo={name:"jsVectors"},n.prototype=new t;var r=function(){var t=function(){!function(t){var n,i,r,o,s,e,a,y;t.add=function(t,n){t.x=t.x+n.x,t.y=t.y+n.y},t.angleBetween=function(t,n){var i=this.normalize({x:t.x,y:t.y}),r=this.normalize({x:n.x,y:n.y}),o=this.crossProd(i,r),s=this.dotProd(i,r),e=Math.acos(s);return 0>o&&(e=-1*e),e},t.calc_cat=function(t,n,i,r,o){var s=t*t,e=s*t;return.5*(2*i+(-n+r)*t+(2*n-5*i+4*r-o)*s+(-n+3*i-3*r+o)*e)},t.crossProd=function(t,n){return t.x*n.y-t.y*n.x},t.diff=function(t,n){return{x:n.x-t.x,y:n.y-t.y}},t.dist=function(t,n){var i=t.x-n.x,r=t.y-n.y;return Math.sqrt(i*i+r*r)},t.dotProd=function(t,n){return t.x*n.x+t.y*n.y},t.getBarCoeffs=function(t,n,i){var r=a;return r.A=.5*(-n.y*i.x+t.y*(-n.x+i.x)+t.x*(n.y-i.y)+n.x*i.y),r.sign=r.A<0?-1:1,r.s1=(t.y*i.x-t.x*i.y+(i.y-t.y))*r.sign,r.s2=(i.y-t.y)*r.sign,r.s3=(t.x-i.x)*r.sign,r.t1=(t.x*n.y-t.y*n.x)*r.sign,r.t2=(t.y-n.y)*r.sign,r.t3=(n.x-t.x)*r.sign,r},t.__traitInit&&!t.hasOwnProperty("__traitInit")&&(t.__traitInit=t.__traitInit.slice()),t.__traitInit||(t.__traitInit=[]),t.__traitInit.push(function(){s||(s={x:0,y:0},e={x:0,y:0},n=[0,0,0,0],i={x:0,y:0},r={x:0,y:0},o={x:0,y:0},a={Area:0,s1:0,s2:0,s3:0,t1:0,t2:0,t3:0,sign:0},y={x:0,y:0})}),t.initProjection=function(t,n){r.y=n.y-t.y,r.x=n.x-t.x,i.y=r.y,i.x=r.x,this.normalize(r),this.normalize(i),this.rotate(i,Math.PI/2),o.x=t.x,o.y=t.y},t.length=function(t){var n=t.x,i=t.y;return Math.sqrt(n*n+i*i)},t.linesIntersect=function(t,n,i,r){var o=t.x,s=t.y,e=n.x,a=n.y,y=i.x,f=i.y,x=r.x,h=r.y,u=((o*a-s*e)*(y-x)-(o-e)*(y*h-f*x))/((o-e)*(f-h)-(s-a)*(y-x)),c=((o*a-s*e)*(f-h)-(s-a)*(y*h-f*x))/((o-e)*(f-h)-(s-a)*(y-x));if(isNaN(u)||isNaN(c))return!1;if(o>=e){if(!(u>=e&&o>=u))return!1}else if(!(u>=o&&e>=u))return!1;if(s>=a){if(!(c>=a&&s>=c))return!1}else if(!(c>=s&&a>=c))return!1;if(y>=x){if(!(u>=x&&y>=u))return!1}else if(!(u>=y&&x>=u))return!1;if(f>=h){if(!(c>=h&&f>=c))return!1}else if(!(c>=f&&h>=c))return!1;return!0},t.mirrorVector=function(t,n,i){s.x=n.x-i.x,s.y=n.y-i.y,e.x=-s.y,e.y=s.x,t.x=t.x-i.x,t.y=t.y-i.y,this.dotProd(t,e)>0&&this.rotate(e,Math.PI),this.normalize(s),this.normalize(e);var r=Math.abs(this.dotProd(t,e)),o=this.dotProd(t,s);return t.x=e.x*r+s.x*o,t.y=e.y*r+s.y*o,t.x+=i.x,t.y+=i.y,t},t.normalize=function(t){var n=Math.sqrt(t.x*t.x+t.y*t.y);if(0==n)throw"Error normalizing vector: the length of the vector was zero";return t.x=t.x/n,t.y=t.y/n,t},t.opposeVector=function(t,n){s.x=n,x,s.y=n.y,e.x=-s.y,e.y=s.x,this.normalize(s),this.normalize(e),this.rotate(s,Math.PI);var i=Math.abs(jsMath.dotProd(t,e)),r=Math.abs(jsMath.dotProd(t,s));return this.dotProd(t,e)<0&&this.rotate(e,Math.PI),t.x=e.x*i+s.x*r,t.y=e.y*i+s.y*r,t},t.pointInTriangle=function(t,n,i,r){var o=.5*(-i.y*r.x+n.y*(-i.x+r.x)+n.x*(i.y-r.y)+i.x*r.y),s=0>o?-1:1,e=(n.y*r.x-n.x*r.y+(r.y-n.y)*t.x+(n.x-r.x)*t.y)*s,a=(n.x*i.y-n.y*i.x+(n.y-i.y)*t.x+(i.x-n.x)*t.y)*s;return e>0&&a>0&&2*o*s>e+a},t.pointInTriangleBc=function(t,n){var i=n.A,r=n.sign,o=n.s1+n.s2*t.x+n.s3*t.y,s=n.t1+n.t2*t.x+n.t3*t.y;return o>0&&s>0&&2*i*r>o+s},t.project=function(t){var n=t;return pVector.x=n.x-o.x,pVector.y=n.y-o.y,prodResult.i=this.dotProd(pVector,r),prodResult.j=this.dotProd(pVector,i),prodResult},t.rotate=function(t,n){var i=Math.sin(n),r=Math.cos(n),o=t.x,s=t.y;return t.x=o*r+s*i,t.y=-o*i+s*r,t},t.rotateAround=function(t,n,i){this.sub(n,i),this.rotate(n,t),this.add(n,i)},t.sub=function(t,n){t.x=t.x-n.x,t.y=t.y-n.y},t.tangentNormal=function(t,n,i){var r={};r.x=n.x-t.x,r.y=n.y-t.y;var o={};o.x=i.x-n.x,o.y=i.y-n.y;var s={x:r.x+o.x,y:r.y+o.y};return this.normalize(s)},t.triangleArea=function(t,n,i){var r=t.x*(n.y-i.y)+n.x*(i.y-t.y)+i.x*(t.y-n.y);return Math.abs(r/2)},t.triangleInTriangle=function(t,n,i,r,o,s){var e=this.getBarCoeffs(t,n,i);if(this.pointInTriangleBc(r,e))return!0;if(this.pointInTriangleBc(o,e))return!0;if(this.pointInTriangleBc(s,e))return!0;var e=this.getBarCoeffs(r,o,s);return this.pointInTriangleBc(t,e)?!0:this.pointInTriangleBc(n,e)?!0:this.pointInTriangleBc(i,e)?!0:this.linesIntersect(t,n,r,o)?!0:this.linesIntersect(n,i,r,o)?!0:this.linesIntersect(i,t,r,o)?!0:this.linesIntersect(t,n,o,s)?!0:this.linesIntersect(n,i,o,s)?!0:this.linesIntersect(i,t,o,s)?!0:this.linesIntersect(t,n,s,r)?!0:this.linesIntersect(n,i,s,r)?!0:this.linesIntersect(i,t,s,r)?!0:!1},t.unProject=function(t){var n=t;return y.x=n.i*r.x+n.j*i.x,y.y=n.i*r.y+n.j*i.y,y.x+=o.x,y.y+=o.y,y}}(this)},n=function(t,i,r,o,s,e,a,y){var f,x=this;if(!(x instanceof n))return new n(t,i,r,o,s,e,a,y);var h=[t,i,r,o,s,e,a,y];if(x.__factoryClass)if(x.__factoryClass.forEach(function(t){f=t.apply(x,h)}),"function"==typeof f){if(f._classInfo.name!=n._classInfo.name)return new f(t,i,r,o,s,e,a,y)}else if(f)return f;x.__traitInit?x.__traitInit.forEach(function(t){t.apply(x,h)}):"function"==typeof x.init&&x.init.apply(x,h)};n._classInfo={name:"jsVectors"},n.prototype=new t,function(t){t.copy=function(t){this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w},t.__traitInit&&!t.hasOwnProperty("__traitInit")&&(t.__traitInit=t.__traitInit.slice()),t.__traitInit||(t.__traitInit=[]),t.__traitInit.push(function(t,n,i,r){this.x=t||0,this.y=n||0,this.z=i||0,this.w=void 0!==r?r:1}),t.inverse=function(){return this.x*=-1,this.y*=-1,this.z*=-1,this},t.multiply=function(t,n){n||(n=t,t=this);var i=t.x*n.w+t.y*n.z-t.z*n.y+t.w*n.x,r=-t.x*n.z+t.y*n.w+t.z*n.x+t.w*n.y,o=t.x*n.y-t.y*n.x+t.z*n.w+t.w*n.z,s=-t.x*n.x-t.y*n.y-t.z*n.z+t.w*n.w;return this.x=i,this.y=r,this.z=o,this.w=s,this},t.normalizeVector3D=function(t){var n=Math.sqrt(t.x*t.x+t.y*t.y+t.z*t.z);return 0==n||isNaN(n)?{x:1,y:0,z:0}:{x:t.x/n,y:t.y/n,z:t.z/n}},t.projectVector=function(t){var n={x:0,y:0,z:0},i=t.x,r=t.y,o=t.z,s=this.x,e=this.y,a=this.z,y=this.w,f=y*i+e*o-a*r,x=y*r+a*i-s*o,h=y*o+s*r-e*i,u=-s*i-e*r-a*o;return n.x=f*y+u*-s+x*-a-h*-e,n.y=x*y+u*-e+h*-s-f*-a,n.z=h*y+u*-a+f*-e-x*-s,n},t.rotate=function(t){return this.setFromAxisRotation({x:0,y:0,z:1},t),this},t.setFromAxisRotation=function(t,n){t=this.normalizeVector3D(t);var i=n/2,r=Math.sin(i);return this.x=t.x*r,this.y=t.y*r,this.z=t.z*r,this.w=Math.cos(i),this}}(this)},o=function(t,n,i,r,s,e,a,y){var f,x=this;if(!(x instanceof o))return new o(t,n,i,r,s,e,a,y);var h=[t,n,i,r,s,e,a,y];if(x.__factoryClass)if(x.__factoryClass.forEach(function(t){f=t.apply(x,h)}),"function"==typeof f){if(f._classInfo.name!=o._classInfo.name)return new f(t,n,i,r,s,e,a,y)}else if(f)return f;x.__traitInit?x.__traitInit.forEach(function(t){t.apply(x,h)}):"function"==typeof x.init&&x.init.apply(x,h)};o._classInfo={name:"quaternion"},o.prototype=new r;var s=function(){!function(t){var i;t.derivate=function(t,n){var i=this._points[t][0],r=this._points[t][1],o=this._points[t][2],s=this._points[t][3],e=n*n,a=1-n,y=a*a,f=3*y*(r-i)+6*n*a*(o-r)+3*e*(s-o);return f},t.distanceOf=function(t,n){var i=this.findClosestT(t,n),r=this.x(i)-t,o=this.y(i)-n;return Math.sqrt(r*r+o*o)},t.findClosestT=function(t,n){for(var i=0,r=.5,o=1,s=10;s--;){var e=this.x(i)-t,a=this.y(i)-n,y=this.x(o)-t,f=this.y(o)-n,x=Math.sqrt(e*e+a*a),h=Math.sqrt(y*y+f*f);h>x?o=r:i=r,r=i+(o-i)/2}var e=this.x(i)-t,a=this.y(i)-n,u=this.x(r)-t,c=this.y(r)-n;y=this.x(o)-t,f=this.y(o)-n;var x=Math.sqrt(e*e+a*a),p=Math.sqrt(u*u+c*c),h=Math.sqrt(y*y+f*f);return p>x&&h>x?i:p>h&&x>h?o:r},t.fitListTo=function(t){{var n={x:t[0].point_x(0),y:t[0].point_y(0)},r=t.length-1,o={x:t[r].point_x(3),y:t[r].point_y(3)},s={x:this.x(0),y:this.y(0)},e={x:this.x(1),y:this.y(1)},a=e.x-s.x,y=e.y-s.y,f=(Math.sqrt(a*a+y*y),o.x-n.x),x=o.y-n.y;Math.sqrt(f*f+x*x),i.angleBetween({x:a,y:y},{x:f,y:x})}},t.fromLine=function(t,n){var i=n.x-t.x,r=i/3;this.initCoeffs(0,t.x,t.x+r,t.x+2*r,n.x);var i=n.y-t.y,r=i/3;this.initCoeffs(1,t.y,t.y+r,t.y+2*r,n.y)},t.fromPoints=function(t,n,i,r){this.initCoeffs(0,t.x,n.x,i.x,r.x),this.initCoeffs(1,t.y,n.y,i.y,r.y)},t.fromQuadCurve=function(t,n,i){this.initCoeffs(0,t.x,t.x+2/3*(n.x-t.x),i.x+2/3*(n.x-i.x),i.x),this.initCoeffs(0,t.y,t.y+2/3*(n.y-t.y),i.y+2/3*(n.y-i.y),i.y)},t.__traitInit&&!t.hasOwnProperty("__traitInit")&&(t.__traitInit=t.__traitInit.slice()),t.__traitInit||(t.__traitInit=[]),t.__traitInit.push(function(){this._points=[],this._m=[],i||(i=n()),this._m=[{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0}]}),t.initCoeffs=function(t,n,i,r,o){this._coeffs||(this._coeffs=[]),this._coeffs[t]||(this._coeffs[t]=[]),this._points[t]||(this._points[t]=[]),this._points[t][0]=n,this._points[t][1]=i,this._points[t][2]=r,this._points[t][3]=o;var s=this._coeffs[t];s[0]=3*(i-n),s[1]=3*(r-i)-s[0],s[2]=o-n-s[0]-s[1],s[3]=n,0==t&&(this._m[0].x=n,this._m[1].x=i,this._m[2].x=r,this._m[3].x=o),1==t&&(this._m[0].y=n,this._m[1].y=i,this._m[2].y=r,this._m[3].y=o)},t.inverseProject=function(t){var n=t.t,i=this.normal(n,!0),r=i.x*t.nvProd+this.x(n),o=i.y*t.nvProd+this.y(n),s=this.tangent(n,!0);r+=t.tangetProd*s.x,o+=t.tangetProd*s.y,t.ix=r,t.iy=o},t.mirrorControls=function(){var t={x:this._points[0][0],y:this._points[1][0]},n={x:this._points[0][3],y:this._points[1][3]},r={x:this._points[0][1],y:this._points[1][1]},o={x:this._points[0][2],y:this._points[1][2]};i.mirrorVector(r,n,t),i.mirrorVector(o,n,t),this.initCoeffs(0,t.x,r.x,o.x,n.x),this.initCoeffs(1,t.y,r.y,o.y,n.y)},t.normal=function(t,n){var r=this.tangent(t),o=r.x;return r.x=-r.y,r.y=o,n&&i.normalize(r),r},t.point_x=function(t){return this._points[0][t]},t.point_y=function(t){return this._points[1][t]},t.points=function(){return this._m},t.projectPoint=function(t,n,i){for(var r=20,o=.5,s=.25;r--;){var e=this.tangent(o,!0);dv.x=t-this.x(o),dv.y=n-this.y(o);var a=dv.x*e.x+dv.y*e.y;if(Math.abs(a)<.05)break;o+=a>0?s:-s,s/=2}var y=this.normal(o,!0);return i||(i={}),i.tangentProd=a,i.nvProd=y.x*dv.x+y.y*d.y,i.nv_x=y.x,i.nv_y=y.y,i.tn_x=e.x,i.tn_y=e.y,i.ix=0,i.iy=0,i.t=o,i},t.setControls=function(t,n,i,r){this.initCoeffs(0,t.x,n.x,i.x,r.x),this.initCoeffs(1,t.y,n.y,i.y,r.y)},t.split=function(t){var n=this._points[0],i=this.splitCoeff(n[0],n[1],n[2],n[3],t);n=this._points[1];var r=this.splitCoeff(n[0],n[1],n[2],n[3],t);this.fromPoints({x:i.p0,y:r.p0},{x:i.p1,y:r.p1},{x:i.p2,y:r.p2},{x:i.p3,y:r.p3});var o=e();return o.fromPoints({x:i.p3,y:r.p3},{x:i.p4,y:r.p4},{x:i.p5,y:r.p5},{x:i.p6,y:r.p6}),o},t.splitCoeff=function(t,n,i,r,o){var s={};s.p0=t,s.p1=(1-o)*t+o*n;var e=(1-o)*n+o*i;return s.p5=(1-o)*i+o*r,s.p2=(1-o)*s.p1+o*e,s.p4=(1-o)*e+o*s.p5,s.p3=(1-o)*s.p2+o*s.p4,s.p6=r,s},t.step=function(t,n){if(this._coeffs){var i=this._coeffs[n];if(i){var r=t*t,o=r*t;return i[2]*o+i[1]*r+i[0]*t+i[3]}}},t.tangent=function(t,n){var r={};return r.x=this.derivate(0,t),r.y=this.derivate(1,t),n&&i.normalize(r),r},t.x=function(t){return this.step(t,0)},t.y=function(t){return this.step(t,1)},t.z=function(t){return this.step(t,2)}}(this)},e=function(t,n,i,r,o,s,a,y){var f,x=this;if(!(x instanceof e))return new e(t,n,i,r,o,s,a,y);var h=[t,n,i,r,o,s,a,y];if(x.__factoryClass)if(x.__factoryClass.forEach(function(t){f=t.apply(x,h)}),"function"==typeof f){if(f._classInfo.name!=e._classInfo.name)return new f(t,n,i,r,o,s,a,y)}else if(f)return f;x.__traitInit?x.__traitInit.forEach(function(t){t.apply(x,h)}):"function"==typeof x.init&&x.init.apply(x,h)};e._classInfo={name:"jsBezierCurve"},e.prototype=new s;var a=function(){var t=function(){!function(t){var n,i,r,o,s,e,a,y;t.add=function(t,n){t.x=t.x+n.x,t.y=t.y+n.y},t.angleBetween=function(t,n){var i=this.normalize({x:t.x,y:t.y}),r=this.normalize({x:n.x,y:n.y}),o=this.crossProd(i,r),s=this.dotProd(i,r),e=Math.acos(s);return 0>o&&(e=-1*e),e},t.calc_cat=function(t,n,i,r,o){var s=t*t,e=s*t;return.5*(2*i+(-n+r)*t+(2*n-5*i+4*r-o)*s+(-n+3*i-3*r+o)*e)},t.crossProd=function(t,n){return t.x*n.y-t.y*n.x},t.diff=function(t,n){return{x:n.x-t.x,y:n.y-t.y}},t.dist=function(t,n){var i=t.x-n.x,r=t.y-n.y;return Math.sqrt(i*i+r*r)},t.dotProd=function(t,n){return t.x*n.x+t.y*n.y},t.getBarCoeffs=function(t,n,i){var r=a;return r.A=.5*(-n.y*i.x+t.y*(-n.x+i.x)+t.x*(n.y-i.y)+n.x*i.y),r.sign=r.A<0?-1:1,r.s1=(t.y*i.x-t.x*i.y+(i.y-t.y))*r.sign,r.s2=(i.y-t.y)*r.sign,r.s3=(t.x-i.x)*r.sign,r.t1=(t.x*n.y-t.y*n.x)*r.sign,r.t2=(t.y-n.y)*r.sign,r.t3=(n.x-t.x)*r.sign,r},t.__traitInit&&!t.hasOwnProperty("__traitInit")&&(t.__traitInit=t.__traitInit.slice()),t.__traitInit||(t.__traitInit=[]),t.__traitInit.push(function(){s||(s={x:0,y:0},e={x:0,y:0},n=[0,0,0,0],i={x:0,y:0},r={x:0,y:0},o={x:0,y:0},a={Area:0,s1:0,s2:0,s3:0,t1:0,t2:0,t3:0,sign:0},y={x:0,y:0})}),t.initProjection=function(t,n){r.y=n.y-t.y,r.x=n.x-t.x,i.y=r.y,i.x=r.x,this.normalize(r),this.normalize(i),this.rotate(i,Math.PI/2),o.x=t.x,o.y=t.y},t.length=function(t){var n=t.x,i=t.y;return Math.sqrt(n*n+i*i)},t.linesIntersect=function(t,n,i,r){var o=t.x,s=t.y,e=n.x,a=n.y,y=i.x,f=i.y,x=r.x,h=r.y,u=((o*a-s*e)*(y-x)-(o-e)*(y*h-f*x))/((o-e)*(f-h)-(s-a)*(y-x)),c=((o*a-s*e)*(f-h)-(s-a)*(y*h-f*x))/((o-e)*(f-h)-(s-a)*(y-x));if(isNaN(u)||isNaN(c))return!1;if(o>=e){if(!(u>=e&&o>=u))return!1}else if(!(u>=o&&e>=u))return!1;if(s>=a){if(!(c>=a&&s>=c))return!1}else if(!(c>=s&&a>=c))return!1;if(y>=x){if(!(u>=x&&y>=u))return!1}else if(!(u>=y&&x>=u))return!1;if(f>=h){if(!(c>=h&&f>=c))return!1}else if(!(c>=f&&h>=c))return!1;return!0},t.mirrorVector=function(t,n,i){s.x=n.x-i.x,s.y=n.y-i.y,e.x=-s.y,e.y=s.x,t.x=t.x-i.x,t.y=t.y-i.y,this.dotProd(t,e)>0&&this.rotate(e,Math.PI),this.normalize(s),this.normalize(e);var r=Math.abs(this.dotProd(t,e)),o=this.dotProd(t,s);return t.x=e.x*r+s.x*o,t.y=e.y*r+s.y*o,t.x+=i.x,t.y+=i.y,t},t.normalize=function(t){var n=Math.sqrt(t.x*t.x+t.y*t.y);if(0==n)throw"Error normalizing vector: the length of the vector was zero";return t.x=t.x/n,t.y=t.y/n,t},t.opposeVector=function(t,n){s.x=n,x,s.y=n.y,e.x=-s.y,e.y=s.x,this.normalize(s),this.normalize(e),this.rotate(s,Math.PI);var i=Math.abs(jsMath.dotProd(t,e)),r=Math.abs(jsMath.dotProd(t,s));return this.dotProd(t,e)<0&&this.rotate(e,Math.PI),t.x=e.x*i+s.x*r,t.y=e.y*i+s.y*r,t},t.pointInTriangle=function(t,n,i,r){var o=.5*(-i.y*r.x+n.y*(-i.x+r.x)+n.x*(i.y-r.y)+i.x*r.y),s=0>o?-1:1,e=(n.y*r.x-n.x*r.y+(r.y-n.y)*t.x+(n.x-r.x)*t.y)*s,a=(n.x*i.y-n.y*i.x+(n.y-i.y)*t.x+(i.x-n.x)*t.y)*s;return e>0&&a>0&&2*o*s>e+a},t.pointInTriangleBc=function(t,n){var i=n.A,r=n.sign,o=n.s1+n.s2*t.x+n.s3*t.y,s=n.t1+n.t2*t.x+n.t3*t.y;return o>0&&s>0&&2*i*r>o+s},t.project=function(t){var n=t;return pVector.x=n.x-o.x,pVector.y=n.y-o.y,prodResult.i=this.dotProd(pVector,r),prodResult.j=this.dotProd(pVector,i),prodResult},t.rotate=function(t,n){var i=Math.sin(n),r=Math.cos(n),o=t.x,s=t.y;return t.x=o*r+s*i,t.y=-o*i+s*r,t},t.rotateAround=function(t,n,i){this.sub(n,i),this.rotate(n,t),this.add(n,i)},t.sub=function(t,n){t.x=t.x-n.x,t.y=t.y-n.y},t.tangentNormal=function(t,n,i){var r={};r.x=n.x-t.x,r.y=n.y-t.y;var o={};o.x=i.x-n.x,o.y=i.y-n.y;var s={x:r.x+o.x,y:r.y+o.y};return this.normalize(s)},t.triangleArea=function(t,n,i){var r=t.x*(n.y-i.y)+n.x*(i.y-t.y)+i.x*(t.y-n.y);return Math.abs(r/2)},t.triangleInTriangle=function(t,n,i,r,o,s){var e=this.getBarCoeffs(t,n,i);if(this.pointInTriangleBc(r,e))return!0;if(this.pointInTriangleBc(o,e))return!0;if(this.pointInTriangleBc(s,e))return!0;var e=this.getBarCoeffs(r,o,s);return this.pointInTriangleBc(t,e)?!0:this.pointInTriangleBc(n,e)?!0:this.pointInTriangleBc(i,e)?!0:this.linesIntersect(t,n,r,o)?!0:this.linesIntersect(n,i,r,o)?!0:this.linesIntersect(i,t,r,o)?!0:this.linesIntersect(t,n,o,s)?!0:this.linesIntersect(n,i,o,s)?!0:this.linesIntersect(i,t,o,s)?!0:this.linesIntersect(t,n,s,r)?!0:this.linesIntersect(n,i,s,r)?!0:this.linesIntersect(i,t,s,r)?!0:!1},t.unProject=function(t){var n=t;return y.x=n.i*r.x+n.j*i.x,y.y=n.i*r.y+n.j*i.y,y.x+=o.x,y.y+=o.y,y}}(this)},n=function(t,i,r,o,s,e,a,y){var f,x=this;if(!(x instanceof n))return new n(t,i,r,o,s,e,a,y);var h=[t,i,r,o,s,e,a,y];if(x.__factoryClass)if(x.__factoryClass.forEach(function(t){f=t.apply(x,h)}),"function"==typeof f){if(f._classInfo.name!=n._classInfo.name)return new f(t,i,r,o,s,e,a,y)}else if(f)return f;x.__traitInit?x.__traitInit.forEach(function(t){t.apply(x,h)}):"function"==typeof x.init&&x.init.apply(x,h)};n._classInfo={name:"jsVectors"},n.prototype=new t,function(t){t.bezierSplit=function(t,n,i,r,o){var s={};s.p1=(1-o)*t+o*n;var e=(1-o)*n+o*i;return s.p5=(1-o)*i+o*r,s.p2=(1-o)*s.p1+o*e,s.p4=(1-o)*e+o*s.p5,s.p3=(1-o)*s.p2+o*s.p4,s},t.endPoint=function(t,n,i){t||(t={x:0,y:0,z:0}),n||(n=o());var r=0;return i||(i=function(t){return t}),this.list.forEach(function(o){if(r++,"Q"==o.cmd){var s=0;o.path.forEach(function(r){r=i(r);var o={x:r.d,y:0,z:0};n.multiply(r.q);var e=n.projectVector(o);t.x+=e.x,t.y+=e.y,t.z+=e.z,s++})}if("M"==o.cmd&&o.path.forEach(function(r){r=i(r);var o={x:r.d,y:0,z:0};n.multiply(r.q);var s=n.projectVector(o);t.x+=s.x,t.y+=s.y,t.z+=s.z}),"L"==o.cmd&&o.path.forEach(function(r){r=i(r);var o={x:r.d,y:0,z:0};n.multiply(r.q);var s=n.projectVector(o);t.x+=s.x,t.y+=s.y,t.z+=s.z}),"C"==o.cmd){var s=0;o.path.forEach(function(r){r=i(r);var o={x:r.d,y:0,z:0};n.multiply(r.q);var e=n.projectVector(o);t.x+=e.x,t.y+=e.y,t.z+=e.z,s++})}}),t},t.__traitInit&&!t.hasOwnProperty("__traitInit")&&(t.__traitInit=t.__traitInit.slice()),t.__traitInit||(t.__traitInit=[]),t.__traitInit.push(function(t){this.list=t}),t.partToSvgPath=function(t,n,i,r){var s="";i||(i={x:0,y:0,z:0}),r||(r=o()),this.addedObjects=[];var e=this,a=0;return this.list.forEach(function(o){if(a++,!(t>a||a>n)){var y=_e("g");if(y.circle().attr({fill:"#ffaa88",cx:i.x,cy:i.y,r:10}),y.svg_text().attr({x:i.x,y:i.y+10,"font-size":20,fill:"black"}).text(a+""),e.addedObjects.push(y),"Q"==o.cmd){var f=0;o.path.forEach(function(t){var n={x:t.d,y:0,z:0};r.multiply(t.q);var o=r.projectVector(n);i.x+=o.x,i.y+=o.y,i.z+=o.z,0==f&&(s+="Q "),s+=" "+i.x.toFixed(3)+", "+i.y.toFixed(3),f++})}if("M"==o.cmd&&o.path.forEach(function(t){var n={x:t.d,y:0,z:0};r.multiply(t.q);var o=r.projectVector(n);i.x+=o.x,i.y+=o.y,i.z+=o.z,s+="M "+i.x.toFixed(3)+", "+i.y.toFixed(3)}),"L"==o.cmd&&o.path.forEach(function(t){var n={x:t.d,y:0,z:0};r.multiply(t.q);var o=r.projectVector(n);i.x+=o.x,i.y+=o.y,i.z+=o.z,s+="L "+i.x.toFixed(3)+", "+i.y.toFixed(3)}),"C"==o.cmd){var f=0;o.path.forEach(function(t){var n={x:t.d,y:0,z:0};r.multiply(t.q);var o=r.projectVector(n);i.x+=o.x,i.y+=o.y,i.z+=o.z,0==f&&(s+="C "),s+=" "+i.x.toFixed(3)+", "+i.y.toFixed(3),f++})}}}),s},t.pathFunction=function(){},t.quadToCubic=function(t,n,i){return{p0:t,p1:t+2/3*(n-t),p2:i+2/3*(n-i),p3:i}},t.toSvgCubicPath=function(t,n){var i="";t||(t={x:0,y:0,z:0}),n||(n=o());var r=0;return this.list.forEach(function(o){var s={x:o.d,y:0,z:0};n.multiply(o.q);var e=n.projectVector(s);t.x+=e.x,t.y+=e.y,t.z+=e.z,i+=0==r?"C "+t.x.toFixed(3)+", "+t.y.toFixed(3):" "+t.x.toFixed(3)+", "+t.y.toFixed(3),r++}),i},t.toSvgPath=function(t,n,i){var r="";t||(t={x:0,y:0,z:0}),n||(n=o()),this.addedObjects=[];var s=0;return i||(i=function(t){return t}),this.list.forEach(function(o){if(s++,"Q"==o.cmd){var e=0;o.path.forEach(function(o){o=i(o);var s={x:o.d,y:0,z:0};n.multiply(o.q);var a=n.projectVector(s);t.x+=a.x,t.y+=a.y,t.z+=a.z,0==e&&(r+="Q "),r+=" "+t.x.toFixed(3)+", "+t.y.toFixed(3),e++})}if("M"==o.cmd&&o.path.forEach(function(o){o=i(o);var s={x:o.d,y:0,z:0};n.multiply(o.q);var e=n.projectVector(s);t.x+=e.x,t.y+=e.y,t.z+=e.z,r+="M "+t.x.toFixed(3)+", "+t.y.toFixed(3)}),"L"==o.cmd&&o.path.forEach(function(o){o=i(o);var s={x:o.d,y:0,z:0};n.multiply(o.q);var e=n.projectVector(s);t.x+=e.x,t.y+=e.y,t.z+=e.z,r+="L "+t.x.toFixed(3)+", "+t.y.toFixed(3)}),"C"==o.cmd){var e=0;o.path.forEach(function(o){o=i(o);var s={x:o.d,y:0,z:0};n.multiply(o.q);var a=n.projectVector(s);t.x+=a.x,t.y+=a.y,t.z+=a.z,0==e&&(r+="C "),r+=" "+t.x.toFixed(3)+", "+t.y.toFixed(3),e++})}}),r}}(this)},y=function(t,n,i,r,o,s,e,a){var f,x=this;if(!(x instanceof y))return new y(t,n,i,r,o,s,e,a);var h=[t,n,i,r,o,s,e,a];if(x.__factoryClass)if(x.__factoryClass.forEach(function(t){f=t.apply(x,h)}),"function"==typeof f){if(f._classInfo.name!=y._classInfo.name)return new f(t,n,i,r,o,s,e,a)}else if(f)return f;x.__traitInit?x.__traitInit.forEach(function(t){t.apply(x,h)}):"function"==typeof x.init&&x.init.apply(x,h)};y._classInfo={name:"pathIterator"},y.prototype=new a,function(t){var r;t.drawPath=function(t){var n,i;t.beginPath(),this._all.forEach(function(r){if("M"==r.name&&(n=r.points[0],i=r.points[1],t.moveTo(n,i)),"m"==r.name&&(n+=r.points[0],i+=r.points[1],t.moveTo(n,i)),"q"==r.name)for(var o=0;o<r.points.length;o+=4){var s=r.points,e=n+s[o+0],a=i+s[o+1],y=n+s[o+2],f=i+s[o+3];n=y,i=f,t.quadraticCurveTo(e,a,y,f,h,u)}if("Q"==r.name)for(var s=r.points,x=r.points.length,o=0;x>o;o+=4)t.quadraticCurveTo(s[o+0],s[o+1],s[o+2],s[o+3]);if("c"==r.name)for(var o=0;o<r.points.length;o+=6){var s=r.points,e=n+s[o+0],a=i+s[o+1],y=n+s[o+2],f=i+s[o+3],h=n+s[o+4],u=i+s[o+5];n=h,i=u,t.bezierCurveTo(e,a,y,f,h,u)}if("C"==r.name)for(var s=r.points,x=r.points.length,o=0;x>o;o+=6)t.bezierCurveTo(s[o+0],s[o+1],s[o+2],s[o+3],s[o+4],s[o+5]);if("l"==r.name)for(var o=0;o<r.points.length;o+=2){var s=r.points,e=n+s[o+0],a=i+s[o+1];n=e,i=a,t.lineTo(e,a)}if("H"==r.name)for(var o=0;o<r.points.length;o++){var s=r.points,e=s[o+0];n=e,t.lineTo(e,i)}if("V"==r.name)for(var o=0;o<r.points.length;o++){var s=r.points,a=s[o+0];i=a,t.lineTo(n,a)}if("L"==r.name)for(var o=0;o<r.points.length;o+=2){var s=r.points,e=s[o+0],a=s[o+1];n=e,i=a,t.lineTo(e,a)}"z"==r.name&&t.closePath()})},t.findDimensions=function(){if(this._limits)return this._limits;var t,n,i,r,o,s,e=function(o,s){"undefined"==typeof t&&(t=o,i=o,n=s,r=s),t=Math.min(t,o),n=Math.min(n,s),i=Math.max(i,o),r=Math.max(r,s)};return this._all.forEach(function(t){if("M"==t.name&&(o=t.points[0],s=t.points[1],e(o,s)),"m"==t.name&&(o+=t.points[0],s+=t.points[1],e(o,s)),"c"==t.name)for(var n=0;n<t.points.length;n+=6){var i=t.points,r=o+i[n+0],a=s+i[n+1],y=o+i[n+2],f=s+i[n+3],x=o+i[n+4],h=s+i[n+5];e(r,a),e(y,f),e(x,h),o=x,s=h}if("C"==t.name)for(var i=t.points,u=t.points.length,n=0;u>n;n+=6)e(i[n+0],i[n+1]),e(i[n+2],i[n+3]),e(i[n+4],i[n+5]);if("l"==t.name)for(var n=0;n<t.points.length;n+=2){var i=t.points,r=o+i[n+0],a=s+i[n+1];o=r,s=a,e(o,s)}if("L"==t.name)for(var n=0;n<t.points.length;n+=2){var i=t.points,r=i[n+0],a=i[n+1];o=r,s=a,e(o,s)}}),this._limits=[t,n,i,r],this._limits},t.fitPathInto=function(t,n){for(var i=this.findDimensions(),r=!0,o=0;4>o;o++)(i[o]<0||i[o]>t)&&(r=!1);var s=Math.abs(i[2]-i[0]),e=Math.abs(i[3]-i[1]),a=!1;Math.abs(i[3])<Math.abs(i[1])&&(a=!0);var y=t/s,f=n/e,x=-i[0],h=-i[1],u=Math.min(y,f),c=u;a&&(c=-c,h=-i[3]);var p=function(t){return(t+x)*u},l=function(t){return(t+h)*c};this._all.forEach(function(t){if("M"==t.name&&(t.points[0]=p(t.points[0]),t.points[1]=l(t.points[1])),"m"==t.name&&(t.points[0]*=u,t.points[1]*=c),"L"==t.name)for(var n=0;n<t.points.length;n+=2){var i=t.points;i[n+0]=p(i[n+0]),i[n+1]=l(i[n+1])}if("c"==t.name)for(var n=0;n<t.points.length;n+=6){var i=t.points;i[n+0]*=u,i[n+2]*=u,i[n+4]*=u,i[n+1]*=c,i[n+3]*=c,i[n+5]*=c}if("C"==t.name)for(var i=t.points,r=t.points.length,n=0;r>n;n+=6)i[n+0]=p(i[n+0]),i[n+2]=p(i[n+2]),i[n+4]=p(i[n+4]),i[n+1]=l(i[n+1]),i[n+3]=l(i[n+3]),i[n+5]=l(i[n+5]);if("Q"==t.name)for(var i=t.points,r=t.points.length,n=0;r>n;n+=4)i[n+0]=p(i[n+0]),i[n+2]=p(i[n+2]),i[n+1]=l(i[n+1]),i[n+3]=l(i[n+3]);if("l"==t.name)for(var n=0;n<t.points.length;n+=2){var i=t.points;i[n+0]*=u,i[n+1]*=c}}),this._limits=null},t.flowerCurve=function(t,r){r=r||{};var o,s=r.leafCount||5,e=0,a=!0,y=[{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0}],f=360/s,x=0,h=i();h.parse(t),h.makePathAbsolute();var u=h.toBezierArray();console.log(u);var c=u[0];if(c){var p=c.point_x(0),l=c.point_y(0),v=canvasContext();v.beginPath();for(var _=u.length;s>x;x++){v.translate(p,l),v.rotate(f*Math.PI/180),v.translate(-p,-l),e=0,a=!0;for(var m,d={x:0,y:0},g={x:0,y:0};(o=u[e++])&&(m=o.points(),m[1])&&(a&&(v.moveTo(m[0].x,m[0].y),g.x=m[0].x,g.y=m[0].y),v.bezierCurveTo(m[1].x,m[1].y,m[2].x,m[2].y,m[3].x,m[3].y),e!=_);)a=!1;d.x=m[3].x,d.y=m[3].y;var I=n();for(e-=1;o=u[e--];){var m=o.points();if(y[0].x=m[0].x,y[0].y=m[0].y,y[1].x=m[1].x,y[1].y=m[1].y,y[2].x=m[2].x,y[2].y=m[2].y,I.mirrorVector(y[0],d,g),I.mirrorVector(y[1],d,g),I.mirrorVector(y[2],d,g),v.bezierCurveTo(y[2].x,y[2].y,y[1].x,y[1].y,y[0].x,y[0].y),0>e)break;a=!1}}return v.svgPathString()}},t.forCmds=function(t){this._all.forEach(t)},t.fromBezierArray=function(t){{var n,i=t.length;this._all}this._all=[];for(var n=0;i>n;n++){var r=t[n];if(0==n){var o={name:"M",points:[r.point_x(0),r.point_y(0)]};this._all.push(o)}var o={name:"C",points:[r.point_x(1),r.point_y(1),r.point_x(2),r.point_y(2),r.point_x(3),r.point_y(3)]};this._all.push(o)}this.saveToOriginals()},t.getCommands=function(){return this._all},t.getPath=function(t){return this._all[t]},t.getSegmentCount=function(){var t=this._all.length;return"z"==this._all[t-1].name&&t--,t},t.getSubPaths=function(){return this._subPaths},t.__traitInit&&!t.hasOwnProperty("__traitInit")&&(t.__traitInit=t.__traitInit.slice()),t.__traitInit||(t.__traitInit=[]),t.__traitInit.push(function(){this._activeCmd=null,this._all=[],this._stringLeft="",this._original=null,this._x=0,this._y=0,r||(r={})}),t.initCmd=function(t){return this._activeCmd={name:t,points:[]},this._all.push(this._activeCmd),this._activeCmd},t.inverse=function(){var t,n=this.originals(),i=n.length;this._all.reverse();var n=(this._all,this._all),r=[],o=function(t,n){for(var i=[],r=t.points.length/2,o=t.points.length-4;r>0;){if(1==r){if(!n)return i;o=n.points.length-2,i.push(n.points[o]),i.push(n.points[o+1])}else i.push(t.points[o]),i.push(t.points[o+1]),o-=2;r--}return i};"z"==n[0].name&&n.shift();for(var t=0;i>t;t++){{var s,e=n[t];n[t],n[t+1]}if(!e)break;if(t>0&&(s=n[t-1]),0==t){var a=e.points.length-2,y={name:"M",points:[e.points[a],e.points[a+1]]};r.push(y)}else{var y={name:s.name,points:o(s,e)};r.push(y)}}var y={name:"z",points:[]};r.push(y),this._all=r},t.makePathAbsolute=function(){var t,n,i,r,o=!0,s=function(){o&&(i=t,r=n);var s=t-i,e=n-r;return{x:t+s,y:n+e}};this._all.forEach(function(e){if("M"==e.name&&(t=e.points[0],n=e.points[1],o=!0),"L"==e.name&&(t=e.points[0],n=e.points[1],o=!0),"m"==e.name&&(t+=e.points[0],n+=e.points[1],e.points[0]=t,e.points[1]=n,e.name="M",o=!0),"T"==e.name){var a=e.points,y=s(),f=[];f[0]=y.x,f[1]=y.y,f[2]=a[0],f[3]=a[1],t=f[2],n=f[3],i=f[0],r=f[1],e.name="Q",e.points=f,o=!1}if("t"==e.name){var a=e.points,y=s(),f=[];f[0]=y.x,f[1]=y.y,f[2]=t+a[0],f[3]=n+a[1],t=f[2],n=f[3],i=f[0],r=f[1],e.name="Q",e.points=f,o=!1}if("q"==e.name){for(var x=0;x<e.points.length;x+=4){var a=e.points;a[x+0]=t+a[x+0],a[x+1]=n+a[x+1],a[x+2]=t+a[x+2],a[x+3]=n+a[x+3],t=a[x+2],n=a[x+3],e.name="Q"}o=!0}if("C"==e.name){var a=e.points;i=a[2],r=a[3],t=a[4],n=a[5],o=!1}if("c"==e.name){for(var x=0;x<e.points.length;x+=6){var a=e.points;a[x+0]=t+a[x+0],a[x+1]=n+a[x+1],a[x+2]=t+a[x+2],a[x+3]=n+a[x+3],a[x+4]=t+a[x+4],a[x+5]=n+a[x+5],t=a[x+4],n=a[x+5],i=a[x+2],r=a[x+3],e.name="C"}o=!1}if("S"==e.name){var a=e.points,y=s(),f=[];f[0]=y.x,f[1]=y.y,f[2]=a[0],f[3]=a[1],f[4]=a[2],f[5]=a[3],t=f[4],n=f[5],i=f[2],r=f[3],e.name="C",e.points=f,o=!1}if("s"==e.name){var a=e.points,y=s(),f=[];f[0]=y.x,f[1]=y.y,f[2]=t+a[0],f[3]=n+a[1],f[4]=t+a[2],f[5]=n+a[3],t=f[4],n=f[5],i=f[2],r=f[3],e.name="C",e.points=f,o=!1}if("h"==e.name){o=!0;for(var x=0;x<e.points.length;x++){var a=e.points,h=t+a[x+0];return t=h,a[x+0]=h,e.points=[h,n],void(e.name="L")}}if("H"==e.name){o=!0;for(var x=0;x<e.points.length;x++){var a=e.points,h=a[x+0];
return t=h,a[x+0]=h,e.points=[h,n],void(e.name="L")}}if("V"==e.name){o=!0;for(var x=0;x<e.points.length;x++){var a=e.points,u=a[x+0];return n=u,e.points=[t,u],void(e.name="L")}}if("v"==e.name){o=!0;for(var x=0;x<e.points.length;x++){var a=e.points,u=n+a[x+0];return n=u,e.points=[t,u],void(e.name="L")}}if("l"==e.name){o=!0;for(var x=0;x<e.points.length;x+=2){var a=e.points,h=t+a[x+0],u=n+a[x+1];t=h,n=u,a[x+0]=h,a[x+1]=u,e.name="L"}}})},t.n=function(t){return t.toFixed(5)},t.normalize=function(t,n){t||(t=800),n||(n=800),this.makePathAbsolute(),this.fitPathInto(t,n)},t.originals=function(){return this._original||(this._original=JSON.parse(JSON.stringify(this._all))),this._original},t.parse=function(t){this._activeCmd=null,this._all=[],this._stringLeft="",this._original=null,this._x=0,this._y=0,this._usedCommands={},t||(t="M25.979,12.896 L 5.979,12.896,5.979,19.562,25.979,19.562z");var n=t,i=0,r=1e4;for(this._subPaths=t.split("M"),this._subIndex=0;(n=this.popCommand(n))&&0!=n.length&&n.length!=i&&!(r--<0);)i=n.length;return this._all},t.path=function(){return this._all},t.pathFunction=function(){},t.popCommand=function(t){t=t.trim();var n=t.charAt(0),i=null;if("M"==n&&(i=this.initCmd(n),t=t.substring(1)),"m"==n&&(i=this.initCmd(n),t=t.substring(1)),"Q"==n&&(i=this.initCmd(n),t=t.substring(1)),"q"==n&&(i=this.initCmd(n),t=t.substring(1)),"S"==n&&(i=this.initCmd(n),t=t.substring(1)),"s"==n&&(i=this.initCmd(n),t=t.substring(1)),"C"==n&&(i=this.initCmd(n),t=t.substring(1)),"c"==n&&(i=this.initCmd(n),t=t.substring(1)),"H"==n&&(i=this.initCmd(n),t=t.substring(1)),"h"==n&&(i=this.initCmd(n),t=t.substring(1)),"T"==n&&(i=this.initCmd(n),t=t.substring(1)),"t"==n&&(i=this.initCmd(n),t=t.substring(1)),"V"==n&&(i=this.initCmd(n),t=t.substring(1)),"v"==n&&(i=this.initCmd(n),t=t.substring(1)),"L"==n&&(i=this.initCmd(n),t=t.substring(1)),"l"==n&&(i=this.initCmd(n),t=t.substring(1)),"Z"==n&&(i=this.initCmd(n),t=t.substring(1)),"z"==n&&(i=this.initCmd(n),t=t.substring(1)),i){this._usedCommands[n]="true",t=t.trim();for(var r=!0;r&&t.length>0;){var o=t.charAt(0);","==o&&(t=t.substring(1),t=t.trim());for(var s=["-","1","2","3","4","5","6","7","8","9","0","."],e="",a=0;s.indexOf(t.charAt(0))>=0&&!("-"==t.charAt(0)&&(a++,a>1));)e+=t.charAt(0),t=t.substring(1),a=1;if(!(e.length>0))break;i.points.push(parseFloat(e)),t=t.trim()}}return i||(console.error("No command found for"),console.error(t)),this._activeCmd=i,this._stringLeft=t,t},t.relativePosition=function(t){var n=this.toBezierArray(),i=n.length,r=i*t,o=Math.floor(r);o>=i&&(o=i-1),0>o&&(o=0);var s=n[o],e=1/i,a=o/i,y=t,f=y-a,x=f/e,h={x:0,y:0,normal:{x:0,y:0}};h.x=s.x(x),h.y=s.y(x);var u=s.tangent(x,!0);return h.normal.x=u.x,h.normal.y=u.y,h},t.replacePartWith=function(t,r,s){var e=function(t,r){var s=i();s.parse(t),s.makePathAbsolute();var e=s.toBezierArray();s.fromBezierArray(e),r&&s.inverse();var a=s.toQuaternionPath(),f=function(t,i){var r=y(a),s=r.endPoint(),e="M 0 0 "+r.toSvgPath(),f=t;if(0==i.x&&0==i.y)return"";var x=Math.sqrt(s.x*s.x+s.y*s.y),h=Math.sqrt(i.x*i.x+i.y*i.y),u=h/x;if(0==x)return e;var c=n(),p=c.angleBetween(s,i),e=r.toSvgPath(f,o().rotate(p),function(t){return t.d=t.d*u,t});return e};return f},a=this.getPath(t);a.replaceFunction=e(r,s)},t.saveToOriginals=function(){this._original=JSON.parse(JSON.stringify(this._all))},t.scaleFactor=function(t,n){var i=this.findDimensions(),r=Math.abs(i[2]-i[0]),o=Math.abs(i[3]-i[1]),s=t/r,e=n/o,a=Math.min(s,e);return a},t.svgString=function(){var t,n,i="",r=this;return this._all.forEach(function(o){if("M"==o.name&&(t=o.points[0],n=o.points[1],i+="M"+r.n(t)+","+r.n(n)+" "),"m"==o.name&&(t+=o.points[0],n+=o.points[1],i+="M"+r.n(t)+","+r.n(n)+" "),"q"==o.name){i+="Q";for(var s=0;s<o.points.length;s+=4){var e=o.points,a=t+e[s+0],y=n+e[s+1],f=t+e[s+2],x=n+e[s+3];t=f,n=x,i+=r.n(a)+","+r.n(y)+" "+r.n(f)+","+r.n(x)+" "}}if("Q"==o.name){var e=o.points,h=o.points.length;i+="Q";for(var s=0;h>s;s+=4){var a=e[s+0],y=e[s+1],f=e[s+2],x=e[s+3];t=f,n=x,i+=r.n(a)+","+r.n(y)+" "+r.n(f)+","+r.n(x)+" "}}if("c"==o.name){i+="C";for(var s=0;s<o.points.length;s+=6){var e=o.points,a=t+e[s+0],y=n+e[s+1],f=t+e[s+2],x=n+e[s+3],u=t+e[s+4],c=n+e[s+5];t=u,n=c,i+=r.n(a)+","+r.n(y)+" "+r.n(f)+","+r.n(x)+" "+r.n(u)+","+r.n(c)+" "}}if("C"==o.name){var e=o.points,h=o.points.length;if(o.replaceFunction){for(var p={x:t,y:n},s=0;h>s;s+=6)t=e[s+4],n=e[s+5];var l={x:t-p.x,y:n-p.y},v=o.replaceFunction(p,l);i+=" "+v+" "}else{i+="C";for(var s=0;h>s;s+=6)i+=r.n(e[s+0])+","+r.n(e[s+1])+" "+r.n(e[s+2])+","+r.n(e[s+3])+" "+r.n(e[s+4])+","+r.n(e[s+5])+" ",t=e[s+4],n=e[s+5]}}if("l"==o.name){i+="L";for(var s=0;s<o.points.length;s+=2){var e=o.points,a=t+e[s+0],y=n+e[s+1];t=a,n=y,i+=r.n(a)+","+r.n(y)+" "}}if("H"==o.name){i+="L";for(var s=0;s<o.points.length;s++){var e=o.points,a=e[s+0];t=a,i+=r.n(a)+","+r.n(n)+" "}}if("V"==o.name){i+="L";for(var s=0;s<o.points.length;s++){var e=o.points,y=e[s+0];n=y,i+=r.n(t)+","+r.n(y)+" "}}if("L"==o.name)if(o.replaceFunction){for(var p={x:t,y:n},s=0;s<o.points.length;s+=2){var e=o.points,a=e[s+0],y=e[s+1];t=a,n=y}var l={x:t-p.x,y:n-p.y},v=o.replaceFunction(p,l);i+=" "+v+" "}else{i+="L";for(var s=0;s<o.points.length;s+=2){var e=o.points,a=e[s+0],y=e[s+1];t=a,n=y,i+=r.n(a)+","+r.n(y)+" "}}"z"==o.name&&(i+="z")}),i},t.toBezierArray=function(){var t,n,i="",r=[];return this._all.forEach(function(o){if("M"==o.name&&(t=o.points[0],n=o.points[1]),"Q"==o.name)for(var s=o.points,a=o.points.length,y=0;a>y;y+=4){var f=s[y+0],x=s[y+1],h=s[y+2],u=s[y+3],c=new e;c.fromQuadCurve({x:t,y:n},{x:f,y:x},{x:h,y:u}),r.push(c),t=h,n=u}if("C"==o.name)for(var s=o.points,a=o.points.length,y=0;a>y;y+=6){var f=s[y+0],x=s[y+1],h=s[y+2],u=s[y+3],p=s[y+4],l=s[y+5],c=new e;c.fromPoints({x:t,y:n},{x:f,y:x},{x:h,y:u},{x:p,y:l}),r.push(c),t=p,n=l}if("L"==o.name){i+="L";for(var y=0;y<o.points.length;y+=2){var s=o.points,f=s[y+0],x=s[y+1],c=new e;c.fromLine({x:t,y:n},{x:f,y:x}),r.push(c),t=f,n=x}}}),r},t.toQuaternionPath=function(){var t=!0,i={x:0,y:0},r={x:100,y:0},s={x:100,y:0},e=n(),a=[];return this.forCmds(function(n){var y={cmd:n.name,path:[]},f=function(n,a){r.x=n-i.x,r.y=a-i.y;var f=Math.sqrt(r.x*r.x+r.y*r.y);0==f&&(r.x+=.2,r.y+=.2,n+=.02,a+=.02,f=Math.sqrt(r.x*r.x+r.y*r.y));var x=e.angleBetween(s,r),h=o();h.setFromAxisRotation({x:0,y:0,z:1},x),t||y.path.push({q:h,d:f}),t=!1,i.x=n,i.y=a,s.x=r.x,s.y=r.y};"M"==n.name&&f(n.points[0],n.points[1]),"L"==n.name&&f(n.points[0],n.points[1]),"Q"==n.name&&(f(n.points[0],n.points[1]),f(n.points[2],n.points[3])),"C"==n.name&&(f(n.points[0],n.points[1]),f(n.points[2],n.points[3]),f(n.points[4],n.points[5])),y.path.length&&a.push(y)}),a},t.transformPoints=function(t){for(var n,i=this.originals(),r={x:0,y:0},o=i.length,n=(this._all,0);o>n;n++){var s=i[n],e=this._all[n];if(!s)return;if("M"==s.name&&(r.x=s.points[0],r.y=s.points[1],t(r),e.points[0]=r.x,e.points[1]=r.y),"Q"==s.name)for(var a=s.points,y=e.points,f=s.points.length,x=0;f>x;x+=4)r.x=a[x+0],r.y=a[x+1],t(r),y[x+0]=r.x,y[x+1]=r.y,r.x=a[x+2],r.y=a[x+3],t(r),y[x+2]=r.x,y[x+3]=r.y;if("C"==s.name)for(var a=s.points,y=e.points,f=s.points.length,x=0;f>x;x+=6)r.x=a[x+0],r.y=a[x+1],t(r),y[x+0]=r.x,y[x+1]=r.y,r.x=a[x+2],r.y=a[x+3],t(r),y[x+2]=r.x,y[x+3]=r.y,r.x=a[x+4],r.y=a[x+5],t(r),y[x+4]=r.x,y[x+5]=r.y;if("L"==s.name)for(var x=0;x<s.points.length;x+=2){var a=s.points,y=e.points;r.x=a[x+0],r.y=a[x+1],t(r),y[x+0]=r.x,y[x+1]=r.y}}}}(this)},i=function(t,n,r,o,s,e,a,y){var f,x=this;if(!(x instanceof i))return new i(t,n,r,o,s,e,a,y);var h=[t,n,r,o,s,e,a,y];if(x.__factoryClass)if(x.__factoryClass.forEach(function(t){f=t.apply(x,h)}),"function"==typeof f){if(f._classInfo.name!=i._classInfo.name)return new f(t,n,r,o,s,e,a,y)}else if(f)return f;x.__traitInit?x.__traitInit.forEach(function(t){t.apply(x,h)}):"function"==typeof x.init&&x.init.apply(x,h)};i._classInfo={name:"svgPathParser"},i.prototype=new n,function(){"undefined"!=typeof define&&null!==define&&null!=define.amd?(t.svgPathParser=i,this.svgPathParser=i):"undefined"!=typeof module&&null!==module&&null!=module.exports?module.exports.svgPathParser=i:this.svgPathParser=i}.call(new Function("return this")()),"undefined"!=typeof define&&null!==define&&null!=define.amd&&define(t)}).call(new Function("return this")());